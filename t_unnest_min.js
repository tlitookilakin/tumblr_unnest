/* Documentation and source code @ https://github.com/tlitookilakin/tumblr_unnest */
function unnest(a,b,c,d,f,g){document.addEventListener("DOMContentLoaded",function(){function h(r){try{return r.children[0].children[0].classList.contains("tumblr_blog")}catch(s){return!1}}var j=window.location.hostname.split(".").slice(0,-2);for(var k of document.getElementsByClassName(a)){var l=document.createElement("p"),m=k.cloneNode(!0),o=m;k.innerHTML="";var p=!h(m);if(2<m.children.length&&!p||p){var q=document.createElement("div");if(q.className=d,f){let r=document.createElement("p");if(r.className="tumblr_blog",0<b){r.innerHTML="<img class='reblog_avatar' src='"+("http://api.tumblr.com/v2/blog/"+j+"/avatar/"+(b+""))+"'/> "}r.innerHTML+="<a"+" href='javascript:void(0)'>"+j+"</a>",c&&(r.innerHTML+=":"),q.appendChild(r)}if(p)q.innerHTML+=m.innerHTML;else{let r=m.children.length;for(let s=2;s<r;s++)q.appendChild(m.children[2])}k.appendChild(q)}for(;!p;){if(p=!h(m),!p){q=document.createElement("div"),q.className=d;let r=m.children[0];if(r.className="tumblr_blog",c||(r.innerHTML=r.innerHTML.slice(0,-1)),r.children[0].removeAttribute("class"),g&&r.children[0].setAttribute("target","_blank"),0<b){let t=r.children[0].innerHTML,u=document.createElement("img");u.setAttribute("src","http://api.tumblr.com/v2/blog/"+t+"/avatar/"+(b+"")),u.className="reblog_avatar",r.insertBefore(u,r.children[0]),r.insertBefore(document.createTextNode(" "),r.children[1])}q.appendChild(r),o=m.children[0].cloneNode(!0),m.removeChild(m.children[0]);let s=o.children.length;for(let t=2;t<s;t++)q.appendChild(o.children[2])}else q=k.children[0],q.innerHTML+=m.innerHTML;m=o,k.insertBefore(q,k.children[0])}}})}
